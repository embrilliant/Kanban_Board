function Anime(a){var b=a;this.startAnimate=function(){setTimeout(function(){b.css({transform:"rotate(-30deg)"})},0),setTimeout(function(){b.css({transform:"rotate(20deg)"})},100),setTimeout(function(){b.css({transform:"rotate(-20deg)"})},200),setTimeout(function(){b.css({transform:"rotate(20deg)"})},300),setTimeout(function(){b.css({transform:"none"})},400)}}function BgImgAction(a){function b(b){var c=b.target.result;document.getElementsByClassName("board")[0].style.backgroundImage="url('"+c+"')",a&&a.updateStorage("bgImgURL",c)}this.imgDropAndDisplay=function(a){a.preventDefault();var c=a.dataTransfer.files[0],d=new FileReader;c&&(d.readAsDataURL(c),d.onload=b)},this.imgSelectAndDisplay=function(a){var c=a.target.files[0],d=new FileReader;c&&(d.readAsDataURL(c),d.onload=b)}}function Board(a,b){var c=a,b=b,d=[];this.getBoardName=function(){return c},this.getNumberOfColumns=function(){return b},this.getAllColumns=function(){return d},this.addOneColumnsToBoard=function(a){d.push(a)},this.removeOneColumnByTitle=function(a){for(var b,c,e=0;e<d.length;e++)d[e].getTitle()===a&&(b=d[e],c=e);d.splice(c,1)},this.getColumnCount=function(){return d.length},this.findColumnByTitle=function(a){for(var b=0;b<d.length;b++)if(d[b].getTitle()===a)return d[b]},this.findColumnByTicketTitle=function(a){for(var b=0;b<d.length;b++)for(var c=0;c<d[b].getTicketCount();c++){var e=d[b].showAllTicket()[c];if(e.getTitle()===a)return d[b]}},this.checkIfATicketExistOnBoard=function(a){for(var b=0;b<d.length;b++)for(var c=0;c<d[b].getTicketCount();c++){var e=d[b].showAllTicket()[c];if(e.getTitle()===a)return!0}}}function Column(a,b){var c=a,d=b,e=[],f=[];this.getTitle=function(){return c},this.getWipNumber=function(){return d},this.setTitle=function(a){c=a},this.showAllTicket=function(){return e},this.getAllSimpleTickets=function(){return f},this.reachedWipOrNot=function(){return e.length<d?!1:!0},this.reachedWipOrNotS=function(){return f.length<d?!1:!0},this.addOneTicket=function(a){e.push(a)},this.addOneSimpleTicket=function(a){f.push(a)},this.setTicketsArrayS=function(a){f=a},this.findTicketByTitle=function(a){for(var b=0;b<e.length;b++)if(e[b].getTitle()===a)return e[b]},this.removeTicketByTitle=function(a){for(var b,c,d=0;d<e.length;d++)e[d].getTitle()===a&&(b=e[d],c=d);e.splice(c,1)},this.removeAllTickets=function(){e=[]},this.getTicketCount=function(){return e.length}}function DAndD(){var a;this.allowDrop=function(a){a.preventDefault()},this.drag=function(b){a=$(b.target).find("span").text()},this.drop=function(b,c){b.preventDefault();var d=b.dataTransfer.files[0];if(!d){var e=$(b.target),f=e.siblings("header").find("span").text(),g=new Ticket(a),h=new Column(f);c(g,h)}},this.bin=function(b,c,d,e){var f=new Ticket(a);d(f,c,e)}}function ErrorMsg(){var a;this.setMsg=function(b){a=b},this.showErrorMsg=function(){$("#errorMsg").text(a).fadeIn(200)}}function LocalStore(){this.retrieveData=function(a){return JSON.parse(localStorage.getItem(a))},this.updateStorage=function(a,b){localStorage.setItem(a,JSON.stringify(b))},this.addToArray=function(a,b){a.push(b)},this.removeDataInArray=function(a,b){for(var c,d=0;d<a.length;d++)a[d].title===b&&(c=d);a.splice(c,1)},this.deleteStorageItem=function(a){localStorage.removeItem(a)}}function LocalStorageHandle(a){this.addDataAndUpdate=function(b,c){var d=c.getTitle().replace(/ /g,"_"),e=a.retrieveData(d);a.addToArray(e,b),a.updateStorage(d,e)},this.removeDataAndUpdate=function(b,c){var d=c.getTitle().replace(/ /g,"_"),e=a.retrieveData(d);a.removeDataInArray(e,b),a.updateStorage(d,e)},this.storageItemClearAndUpdate=function(b,c){a.deleteStorageItem(b),a.updateStorage(b,c.showAllTicket())}}function Render(a){var b=this;this.board=function(b,c){var d=b.getBoardName(),e=b.constructor.name.toLowerCase(),f=$("<div/>",{id:d,"class":e});$("#board_container").append(f);var g=f.get(0);g.addEventListener("drop",c.imgDropAndDisplay,!1),g.addEventListener("dragover",a.allowDrop)},this.column=function(b,c,d){for(var e=b.getAllColumns(),f=0;f<b.getColumnCount();f++){var g=e[f].getTitle(),h=g.replace(/ /g,"_"),i=e[f].constructor.name.toLowerCase(),j=$("<div/>",{id:h,"class":i});j.append("<header><span>"+g+"</span> ("+e[f].getWipNumber()+") </header><section></section>"),$("#"+b.getBoardName()).append(j);var k=j.get(0);k.getElementsByTagName("section")[0].addEventListener("dragover",a.allowDrop,!1),k.getElementsByTagName("section")[0].addEventListener("drop",function(){a.drop(event,c.moveTicket),d.showErrorMsg()},!1)}},this.ticket=function(b){var c=b.getTitle().replace(/ /g,"_"),d=$("#"+c);d.find("section").html("");var e=b.showAllTicket();if(e.length>0)for(var f=0;f<b.getTicketCount();f++){var g=e[f].getTitle(),h=e[f].getDescription(),i=e[f].constructor.name.toLowerCase(),j=$("<div/>",{"class":i,draggable:"true"});j.html("Title: <span>"+g+"</span><br>Description: "+h),d.find("section").append(j);var k=j.get(0);k.addEventListener("dragstart",a.drag,!1)}},this.initialRetrievedData=function(a,c,d,e){null===a&&(e.updateStorage(c,d.showAllTicket()),a=e.retrieveData(c));for(var f=0;f<a.length;f++){var g=a[f].title,h=a[f].description,i=new Ticket(g,h);d.addOneTicket(i)}b.ticket(d);var j=e.retrieveData("bgImgURL");j&&(document.getElementsByClassName("board")[0].style.backgroundImage="url('"+j+"')")}}function Ticket(a,b){var c=a,d=b;this.getTitle=function(){return c},this.getDescription=function(){return d},this.setTitle=function(a){c=a},this.setDescription=function(a){d=a},this.toSimpleTicket=function(){return{title:c,description:d}}}function TicketHandler(a,b,c,d){this.createATicket=function(e,f){var g=a.checkIfATicketExistOnBoard(e.getTitle()),h=f.reachedWipOrNot();if(h)d.setMsg("destination column reached WIP."),console.log("reached WIP.");else if(g)d.setMsg("Ticket already exists."),console.log("Ticket already exists.");else{var i=new Ticket(e.getTitle(),e.getDescription());f.addOneTicket(i);var j=i.toSimpleTicket();c&&c.addDataAndUpdate(j,f),b.ticket(f),d.setMsg("")}},this.moveTicket=function(e,f){var g=a.checkIfATicketExistOnBoard(e.getTitle());if(g){var h=a.findColumnByTicketTitle(e.getTitle()),i=h.findTicketByTitle(e.getTitle()),j=a.findColumnByTitle(f.getTitle()),k=i.toSimpleTicket();j?j.reachedWipOrNot()?(d.setMsg("Destination column reached WIP."),console.log("reached WIP.")):(j.addOneTicket(i),h.removeTicketByTitle(e.getTitle()),b.ticket(h),b.ticket(j),c.removeDataAndUpdate(e.getTitle(),h),c.addDataAndUpdate(k,j),d.setMsg("")):(d.setMsg("Cannot find such column."),console.log("Cannot find such column."))}else d.setMsg("Ticket not found."),console.log("Ticket not found.")},this.deleteTicket=function(e,f,g){var h=a.checkIfATicketExistOnBoard(e.getTitle());if(h){var i=a.findColumnByTicketTitle(e.getTitle());i.getTitle()===f.getTitle()?(f.removeTicketByTitle(e.getTitle()),b.ticket(f),d.setMsg(""),c.removeDataAndUpdate(e.getTitle(),i),g.startAnimate()):(d.setMsg("Ticket can only be deleted from Done."),console.log("Ticket can only be deleted from Done."))}else d.setMsg("Ticket not found."),console.log("Ticket not found.")}}$(function(){function a(){var a=new Ticket;return a.setTitle($("input[name='ticket_title']").val()),a.setDescription($("input[name='ticket_description']").val()),a}function b(){var a=new Column;return a.setTitle($("input[name='column_title']").val()),a}for(var c=new Board("Kanban",4),d=new Column("To Do",5),e=new Column("In Progress",5),f=new Column("Review",5),g=new Column("Done",5),h=new LocalStore,i=new LocalStorageHandle(h),j=new DAndD,k=new BgImgAction(h),l=new ErrorMsg,m=new Render(j),n=new TicketHandler(c,m,i,l),o=new Anime($(document.getElementById("icon_bin"))),p=[d,e,f,g],q=["To_Do","In_Progress","Review","Done"],r=[h.retrieveData(q[0]),h.retrieveData(q[1]),h.retrieveData(q[2]),h.retrieveData(q[3])],s=0;s<p.length;s++)c.addOneColumnsToBoard(p[s]);m.board(c,k),m.column(c,n,l);for(var t=0;t<p.length;t++)m.initialRetrievedData(r[t],q[t],p[t],h);$("#create_a_ticket").on("click",function(b){b.preventDefault(),0!=a().getTitle().length&&0!=a().getDescription().length?(n.createATicket(a(),d),$("input:text").val("")):l.setMsg("Please enter title and description."),l.showErrorMsg()}),$("#move_ticket").on("click",function(c){c.preventDefault(),n.moveTicket(a(),b()),l.showErrorMsg()}),$("#delete_ticket").on("click",function(b){b.preventDefault(),n.deleteTicket(a(),g,o),l.showErrorMsg()}),$("#clear_ticket").on("click",function(a){a.preventDefault();for(var b=0;b<p.length;b++)p[b].removeAllTickets(),m.ticket(p[b]),i.storageItemClearAndUpdate(q[b],p[b])}),$("#selectFiles").on("change",k.imgSelectAndDisplay),$("#dltBgImg").on("click",function(){document.getElementsByClassName("board")[0].style.backgroundImage="none",$("#selectFiles").val(""),h.deleteStorageItem("bgImgURL")}),document.getElementById("bin").addEventListener("dragover",j.allowDrop,!1),document.getElementById("bin").addEventListener("drop",function(){j.bin(event,g,n.deleteTicket,o),l.showErrorMsg()},!1),console.log(h.retrieveData(q[0])),console.log(h.retrieveData(q[1])),console.log(h.retrieveData(q[2])),console.log(h.retrieveData(q[3]))});